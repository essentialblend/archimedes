<UserControl x:Class="archimedes.Views.CodeEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
             xmlns:editing="clr-namespace:ICSharpCode.AvalonEdit.Editing;assembly=ICSharpCode.AvalonEdit"
             xmlns:rendering="clr-namespace:ICSharpCode.AvalonEdit.Rendering;assembly=ICSharpCode.AvalonEdit"
             xmlns:local="clr-namespace:archimedes.Views">

  <UserControl.Resources>
    <Style TargetType="{x:Type editing:TextArea}">
      <Setter Property="SelectionBrush" Value="{DynamicResource Brush.Editor.Selection}"/>
      <Setter Property="SelectionForeground" Value="{DynamicResource Brush.Editor.SelectionFG}"/>
    </Style>

    <Style TargetType="{x:Type rendering:TextView}">
      <Setter Property="CurrentLineBorder" Value="{DynamicResource Pen.Editor.CurrentLineBorder}"/>
      <Setter Property="CurrentLineBackground" Value="{DynamicResource Brush.Editor.CurrentLine}"/>
    </Style>

    <Style x:Key="CompletionListBoxStyle" TargetType="ListBox">
      <Style.Resources>
        <Style x:Key="CompletionScrollThumb" TargetType="{x:Type Thumb}">
          <Setter Property="Background" Value="{DynamicResource Brush.Scrollbar.Thumb}"/>
          <Setter Property="Opacity" Value="0.45"/>
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="{x:Type Thumb}">
                <Border x:Name="ThumbBd"
                        Background="{TemplateBinding Background}"
                        CornerRadius="2"/>
                <ControlTemplate.Triggers>
                  <Trigger Property="IsMouseOver" Value="True">
                    <Setter TargetName="ThumbBd" Property="Background" Value="{DynamicResource Brush.Scrollbar.ThumbHover}"/>
                    <Setter Property="Opacity" Value="0.8"/>
                  </Trigger>
                  <Trigger Property="IsDragging" Value="True">
                    <Setter TargetName="ThumbBd" Property="Background" Value="{DynamicResource Brush.Scrollbar.ThumbHover}"/>
                    <Setter Property="Opacity" Value="0.95"/>
                  </Trigger>
                </ControlTemplate.Triggers>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
        <Style TargetType="{x:Type ScrollBar}">
          <Setter Property="Width" Value="2"/>
          <Setter Property="Background" Value="Transparent"/>
          <Setter Property="BorderThickness" Value="0"/>
          <Setter Property="Opacity" Value="0.6"/>
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="{x:Type ScrollBar}">
                <Grid Background="Transparent"
                      SnapsToDevicePixels="True"
                      ClipToBounds="True"
                      Margin="0,6,4,6">
                  <Track x:Name="PART_Track" IsDirectionReversed="True">
                    <Track.DecreaseRepeatButton>
                      <RepeatButton Command="{x:Static ScrollBar.PageUpCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Focusable="False"/>
                    </Track.DecreaseRepeatButton>
                    <Track.Thumb>
                      <Thumb Style="{StaticResource CompletionScrollThumb}"/>
                    </Track.Thumb>
                    <Track.IncreaseRepeatButton>
                      <RepeatButton Command="{x:Static ScrollBar.PageDownCommand}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Focusable="False"/>
                    </Track.IncreaseRepeatButton>
                  </Track>
                </Grid>
                <ControlTemplate.Triggers>
                  <Trigger Property="Orientation" Value="Horizontal">
                    <Setter Property="Height" Value="2"/>
                    <Setter Property="Margin" Value="6,0,6,4"/>
                  </Trigger>
                </ControlTemplate.Triggers>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </Style.Resources>
      <Setter Property="Background" Value="{DynamicResource Brush.Completion.Panel}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource Brush.Completion.PanelBorder}"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="Padding" Value="6,4,6,4"/>
      <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Main}"/>
      <Setter Property="FontFamily" Value="Cascadia Mono"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="UseLayoutRounding" Value="True"/>
      <Setter Property="SnapsToDevicePixels" Value="True"/>
      <Setter Property="ClipToBounds" Value="True"/>
      <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
      <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
      <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
    </Style>

    <Style x:Key="CompletionListItemStyle" TargetType="ListBoxItem">
      <Setter Property="Padding" Value="6,2"/>
      <Setter Property="Margin" Value="0"/>
      <Setter Property="MinHeight" Value="20"/>
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="Foreground" Value="{DynamicResource Brush.Text.Main}"/>
      <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
      <Style.Triggers>
        <Trigger Property="IsSelected" Value="True">
          <Setter Property="Background" Value="{DynamicResource Brush.Completion.Highlight}"/>
          <Setter Property="Foreground" Value="{DynamicResource Brush.Completion.HighlightText}"/>
        </Trigger>
      </Style.Triggers>
    </Style>

    <DataTemplate x:Key="CompletionItemTemplate">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <TextBlock Text="{Binding Name}"
                   TextTrimming="CharacterEllipsis"/>
        <TextBlock Grid.Column="1"
                   Text="{Binding Kind}"
                   Foreground="{DynamicResource Brush.Text.Dim}"
                   Margin="12,0,0,0"/>
      </Grid>
    </DataTemplate>

  </UserControl.Resources>

  <Grid Background="{DynamicResource Brush.Editor.BG}">
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="{DynamicResource Dim.StatusHeight}"/>
    </Grid.RowDefinitions>

    <avalonedit:TextEditor x:Name="Editor"
                           Grid.Row="0"
                           Loaded="OnEditorLoaded"
                           FontFamily="Cascadia Mono"
                           FontSize="13"
                           ShowLineNumbers="True"
                           Background="{DynamicResource Brush.Editor.BG}"
                           Foreground="{DynamicResource Brush.Editor.FG}"
                           LineNumbersForeground="{DynamicResource Brush.Editor.Gutter.FG}"
                           Padding="12"
                           HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto">
      <avalonedit:TextEditor.Options>
        <avalonedit:TextEditorOptions HighlightCurrentLine="True"
                                      AllowScrollBelowDocument="True"/>
      </avalonedit:TextEditor.Options>
    </avalonedit:TextEditor>

    <local:WrapIndicatorOverlay x:Name="WrapIndicator"
                                Grid.Row="0"
                                IsHitTestVisible="False"
                                Panel.ZIndex="1"/>

    <Border Grid.Row="1"
            Background="{DynamicResource Brush.BG.Bar}"
            BorderBrush="{DynamicResource Brush.Border}"
            BorderThickness="0,1,0,0">

      <Grid VerticalAlignment="Center" Margin="12,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">

          <ComboBox x:Name="ZoomBox"
                    Width="75"
                    Height="22"
                    Style="{DynamicResource BoxedComboBoxStyle}"
                    SelectedIndex="3"
                    IsEditable="True"
                    IsReadOnly="True"
                    VerticalAlignment="Center">
            <ComboBoxItem Content="50%"/>
            <ComboBoxItem Content="75%"/>
            <ComboBoxItem Content="90%"/>
            <ComboBoxItem Content="100%"/>
            <ComboBoxItem Content="110%"/>
            <ComboBoxItem Content="125%"/>
            <ComboBoxItem Content="150%"/>
            <ComboBoxItem Content="200%"/>
            <ComboBoxItem Content="250%"/>
            <ComboBoxItem Content="300%"/>
            <ComboBoxItem Content="400%"/>
            <ComboBoxItem Content="500%"/>
          </ComboBox>

          <ComboBox x:Name="GoToLineBox"
                    Width="70"
                    Height="22"
                    Margin="10,0,0,0"
                    Style="{DynamicResource BoxedComboBoxEditableStyle}"
                    IsEditable="True"
                    IsTextSearchEnabled="False"
                    StaysOpenOnEdit="True"
                    VerticalAlignment="Center"/>

          <Rectangle Width="1" Height="14" 
                     Fill="{DynamicResource Brush.Border.Light}" 
                     Margin="16,0"/>

          <Ellipse Width="6" Height="6" 
                   Fill="{DynamicResource Brush.Acc.Green}" 
                   Margin="0,1,8,0"
                   VerticalAlignment="Center"/>

          <TextBlock x:Name="DiagText"
                     Text="No issues found"
                     Foreground="{DynamicResource Brush.Text.Dim}"
                     FontFamily="Cascadia Mono"
                     FontSize="11"
                     VerticalAlignment="Center"/>
        </StackPanel>

        <Grid Grid.Column="1"
              HorizontalAlignment="Center"
              Width="260"
              VerticalAlignment="Center">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>

          <TextBlock Text="Eval:"
                     Foreground="{DynamicResource Brush.Text.Dim}"
                     FontFamily="Cascadia Mono"
                     FontSize="11"
                     VerticalAlignment="Center"/>

          <TextBlock x:Name="EvalText"
                     Grid.Column="1"
                     Text="Idle"
                     Foreground="{DynamicResource Brush.Text.Dim}"
                     FontFamily="Cascadia Mono"
                     FontSize="11"
                     Margin="6,0,0,0"
                     TextTrimming="CharacterEllipsis"
                     VerticalAlignment="Center"/>
        </Grid>

        <StackPanel Grid.Column="2" 
                    Orientation="Horizontal" 
                    VerticalAlignment="Center">

          <TextBlock x:Name="CaretText"
                     Text="Ln: 1, Col: 1"
                     Foreground="{DynamicResource Brush.Text.Main}"
                     FontFamily="Cascadia Mono"
                     FontSize="11"
                     VerticalAlignment="Center"/>

          <TextBlock Text="|"
                     Foreground="{DynamicResource Brush.Border.Light}"
                     Margin="12,0"
                     FontFamily="Cascadia Mono"
                     FontSize="11"
                     VerticalAlignment="Center"/>

          <TextBlock x:Name="SelText"
                     Text="Sel: 0"
                     Foreground="{DynamicResource Brush.Text.Dim}"
                     FontFamily="Cascadia Mono"
                     FontSize="11"
                     VerticalAlignment="Center"/>

          <Rectangle Width="1" Height="14"
                     Fill="{DynamicResource Brush.Border.Light}"
                     Margin="12,0"
                     VerticalAlignment="Center"/>

          <ToggleButton x:Name="WrapToggle"
                        Style="{DynamicResource StripIconToggle}"
                        IsChecked="True"
                        ToolTip="Word Wrap"
                        Content="."
                        ContentTemplate="{StaticResource Icon.TerminateTemplate}"/>
        </StackPanel>

      </Grid>
    </Border>
  </Grid>
</UserControl>

